- name: GNOME desktop environment media keys
  ansible.builtin.include_tasks:
    file: desktop_environments/gnome/tasks/media_keys.yaml

- name: GNOME desktop environment custom keybindings
  ansible.builtin.include_tasks:
    file: desktop_environments/gnome/tasks/custom_keybindings.yaml

- name: Set general GNOME dconf settings
  become_user: "{{ ansible_env.SUDO_USER }}"
  dconf:
    key: "{{ item.key }}"
    value:  "{{ item.value }}"
  with_items:
    # GNOME desktop
    - key: "/org/gnome/desktop/interface/color-scheme"
      value: "'prefer-dark'"
    - key: "/org/gnome/desktop/sound/allow-volume-above-100-percent"
      value: "true"
    - key: "/org/gnome/desktop/calendar/show-weekdate"
      value: "true"
    - key: "/org/gnome/desktop/interface/gtk-theme"
      value: "'Adwaita-dark'"
    - key: "/org/gnome/desktop/interface/show-battery-percentage"
      value: "true"
    - key: "/org/gnome/desktop/peripherals/touchpad/tap-to-click"
      value: "true"
    # GNOME shell
    - key: "/org/gnome/shell/weather/automatic-location"
      value: "true"
    # GNOME window manager
    - key: "/org/gnome/desktop/wm/keybindings/show-desktop"
      value: ['<Super>d']
    - key: "/org/gnome/desktop/wm/preferences/button-layout"
      value: "':minimize,maximize,close'"
    # GNOME settings-daemon
    - key: "/org/gnome/settings-daemon/plugins/color/night-light-enabled"
      value: "true"
    - key: "/org/gnome/settings-daemon/plugins/color/night-light-temperature"
      value: "3700"

# Nautilus
- name: Set general Nautilus settings
  become_user: "{{ ansible_env.SUDO_USER }}"
  dconf:
    key: "{{ item.key }}"
    value:  "{{ item.value }}"
  with_items:
    - key: "/org/gnome/nautilus/preferences/default-folder-viewer"
      value: "'list-view'"
    - key: "/org/gnome/nautilus/list-view/use-tree-view"
      value: "true"
    - key: "/org/gtk/gtk4/settings/file-chooser/sort-directories-first"
      value: "true"
    - key: "/org/gnome/nautilus/preferences/show-create-link"
      value: "true"
    - key: "/org/gnome/nautilus/preferences/show-delete-permanently"
      value: "true"
    - key: "/org/gnome/nautilus/icon-view/captions"
      value: "['size', 'none', 'none']"

# Nemo
- name: Install Nemo
  ansible.builtin.package:
    name: nemo

- name: Get default filemanager
  become_user: "{{ ansible_env.SUDO_USER }}"
  ansible.builtin.shell: xdg-mime query default inode/directory
  register: default_filemanager

- name: Set Nemo as the default filemanager
  become_user: "{{ ansible_env.SUDO_USER }}"
  ansible.builtin.shell: xdg-mime default nemo.desktop inode/directory application/x-gnome-saved-search
  when: "'nautilus' in default_filemanager.stdout.lower()"

- name: Configure Nemo
  become_user: "{{ ansible_env.SUDO_USER }}"
  community.general.dconf:
    key: "{{ item.key }}"
    value: "{{ item.value }}"
  with_items:
    - key: "/org/gnome/desktop/background/show-desktop-icons"
      value: "false"
    - key: "/org/nemo/desktop/show-desktop-icons"
      value: "true"
    - key: "/org/nemo/preferences/default-folder-viewer"
      value: "'list-view'"
    - key: "/org/nemo/preferences/inherit-folder-viewer"
      value: "true"


# GNOME extensions
- name: Install GNOME extension packages
  ansible.builtin.package:
    name:
      - gnome-tweaks
      - gnome-shell-extensions
      - gnome-shell-extension-prefs
      - gnome-shell-extension-manager
      - gir1.2-gtop-2.0
      - lm-sensors
      - nvme-cli
      - udisks2

# lookinto https://pypi.org/project/gnome-extensions-cli/
# User installed / third party
  # Freon or Vitals
  # cpufreq
# System Extensinos
  # Ubuntu AppIndicators (ubuntu-appindicators@ubuntu.com)
  # User Themes (user-theme@gnome-shell-extensions.gcampax.github.com)


- name: Configure GNOME extensions
  become_user: "{{ ansible_env.SUDO_USER }}"
  dconf:
    key: "{{ item.key }}"
    value:  "{{ item.value }}"
  with_items:
    - key: "/org/gnome/shell/enabled-extensions"
      value: "['ubuntu-appindicators@ubuntu.com', 'user-theme@gnome-shell-extensions.gcampax.github.com']"
    - key: "/org/gnome/shell/extensions/appindicator/tray-pos"
      value: "'center'"